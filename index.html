<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìº”ë²„ìŠ¤ ì¹˜ìˆ˜ ê³„ì‚°ê¸°</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Space+Mono:wght@400;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #f5f4f0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Noto Sans KR', sans-serif;
    padding: 24px;
  }

  .card {
    background: #ffffff;
    border-radius: 20px;
    padding: 40px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 4px 40px rgba(0,0,0,0.08);
  }

  h1 { font-size: 20px; font-weight: 700; color: #1a1a1a; margin-bottom: 4px; }
  .subtitle { font-size: 13px; color: #999; margin-bottom: 32px; }

  .section-label {
    font-size: 11px; font-weight: 700; letter-spacing: 0.08em;
    text-transform: uppercase; color: #aaa; margin-bottom: 12px;
  }

  .input-group {
    display: grid; grid-template-columns: 1fr 1fr 1fr;
    gap: 12px; margin-bottom: 28px;
  }

  .input-wrap { display: flex; flex-direction: column; gap: 6px; }
  .input-wrap label { font-size: 12px; font-weight: 500; color: #555; }

  .input-wrap input {
    border: 1.5px solid #e0e0e0; border-radius: 10px;
    padding: 10px 12px; font-size: 15px;
    font-family: 'Space Mono', monospace; font-weight: 700;
    color: #1a1a1a; background: #fafafa; text-align: center;
    outline: none; transition: border-color 0.2s, box-shadow 0.2s; width: 100%;
  }
  .input-wrap input:focus {
    border-color: #4f46e5; box-shadow: 0 0 0 3px rgba(79,70,229,0.1); background: #fff;
  }

  .unit { font-size: 11px; color: #bbb; text-align: center; }

  .divider {
    display: flex; align-items: center; gap: 12px;
    margin-bottom: 28px; color: #ccc; font-size: 12px;
  }
  .divider::before, .divider::after {
    content: ''; flex: 1; height: 1px; background: #ebebeb;
  }

  .offset-info { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 28px; }
  .offset-chip {
    background: #f0f0f0; border-radius: 8px; padding: 8px 0;
    text-align: center; font-size: 12px; color: #777;
  }
  .offset-chip span {
    display: block; font-family: 'Space Mono', monospace;
    font-size: 14px; font-weight: 700; color: #4f46e5; margin-top: 2px;
  }

  /* ì œí’ˆ ì •ë³´ ì¹´ë“œ */
  .product-card {
    background: #f8f7ff;
    border: 1.5px solid #e0deff;
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    transition: all 0.3s;
  }
  .product-card.not-found {
    background: #fff8f0;
    border-color: #ffe0cc;
  }
  .product-card.loading {
    background: #f4f4f4;
    border-color: #e0e0e0;
  }
  .product-name {
    font-size: 14px; font-weight: 700; color: #3730a3;
  }
  .product-card.not-found .product-name { color: #c05c00; }
  .product-card.loading .product-name { color: #999; }
  .product-price {
    font-family: 'Space Mono', monospace;
    font-size: 18px; font-weight: 700; color: #4f46e5;
    white-space: nowrap;
  }
  .product-card.not-found .product-price { color: #c05c00; font-size: 13px; font-family: 'Noto Sans KR', sans-serif; }
  .product-card.loading .product-price { color: #bbb; font-size: 13px; font-family: 'Noto Sans KR', sans-serif; }

  /* ì‹œíŠ¸ ìƒíƒœ í‘œì‹œ */
  .sheet-status {
    font-size: 11px; color: #bbb; text-align: right;
    margin-bottom: 8px; min-height: 16px;
  }
  .sheet-status.ok { color: #10b981; }
  .sheet-status.err { color: #ef4444; }

  /* ê²°ê³¼ ë°•ìŠ¤ */
  .result-box {
    background: #1a1a2e; border-radius: 14px;
    padding: 24px 28px 28px; text-align: center;
  }

  .result-label {
    font-size: 11px; font-weight: 700; letter-spacing: 0.1em;
    text-transform: uppercase; color: #6b7280; margin-bottom: 16px;
  }

  .placeholder { color: #4b5563; font-size: 13px; font-style: italic; padding: 32px 0; }

  #diagram-wrap { width: 100%; display: flex; justify-content: center; align-items: center; }
  #diagram-wrap svg { overflow: visible; }
</style>
</head>
<body>

<div class="card">
  <h1>ìº”ë²„ìŠ¤ ì¹˜ìˆ˜ ê³„ì‚°ê¸°</h1>
  <p class="subtitle">ìº”ë²„ìŠ¤ ì¹˜ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ ì•¡ì ì‚¬ì´ì¦ˆë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>

  <div class="section-label">ìº”ë²„ìŠ¤ ì›ë³¸ ì¹˜ìˆ˜ (mm)</div>
  <div class="input-group">
    <div class="input-wrap">
      <label>ê°€ë¡œ (W)</label>
      <input type="number" id="width" placeholder="0" min="0" oninput="calculate()">
      <div class="unit">mm</div>
    </div>
    <div class="input-wrap">
      <label>ì„¸ë¡œ (H)</label>
      <input type="number" id="height" placeholder="0" min="0" oninput="calculate()">
      <div class="unit">mm</div>
    </div>
    <div class="input-wrap">
      <label>ë‘ê»˜ (D)</label>
      <input type="number" id="depth" placeholder="0" min="0" oninput="calculate()">
      <div class="unit">mm</div>
    </div>
  </div>

  <div class="divider">ì¶”ê°€ ì—¬ìœ ë¶„</div>

  <div class="offset-info">
    <div class="offset-chip">ê°€ë¡œ<span>+30 mm</span></div>
    <div class="offset-chip">ì„¸ë¡œ<span>+30 mm</span></div>
    <div class="offset-chip">ë‘ê»˜<span>+17 mm</span></div>
  </div>

  <!-- ì œí’ˆ ì •ë³´ ì˜ì—­ -->
  <div class="sheet-status" id="sheet-status"></div>
  <div id="product-area"></div>

  <!-- ì•¡ì ë„ë©´ -->
  <div class="result-box">
    <div class="result-label">ì•¡ì ì‚¬ì´ì¦ˆ</div>
    <div id="result">
      <div class="placeholder">ì¹˜ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ ë„ë©´ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
    </div>
  </div>
</div>

<script>
// â”€â”€ êµ¬ê¸€ ì‹œíŠ¸ CSV URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SHEET_CSV_URL = 'https://script.google.com/macros/s/AKfycbzGh9nEKr40IOoWtD2Q4fyW0Fl9eKoc3egYMb-GF7e6-IyW3cPmO5-9m2cUBrHAyCY/exec';
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let sheetData = [];      // [{width, height, name, price}, ...]
let sheetLoaded = false;
let sheetError = false;

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œíŠ¸ ë°ì´í„° ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê¸°
async function loadSheet() {
  const statusEl = document.getElementById('sheet-status');
  statusEl.textContent = 'ì‹œíŠ¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦';
  try {
    const res = await fetch(SHEET_CSV_URL);
    if (!res.ok) throw new Error('fetch failed');
    const json = await res.json();
    sheetData = json.map(row => {
      const obj = {};
      Object.keys(row).forEach(k => { obj[k.trim().toLowerCase()] = String(row[k]).trim(); });
      return obj;
    }).filter(r => r.width || r.name);
    sheetLoaded = true;
    statusEl.textContent = `âœ“ ì‹œíŠ¸ ì—°ë™ë¨ (${sheetData.length}ê°œ ì œí’ˆ)`;
    statusEl.className = 'sheet-status ok';
    calculate();
  } catch (e) {
    sheetError = true;
    statusEl.textContent = 'âš  ì‹œíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. URLì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
    statusEl.className = 'sheet-status err';
  }
}

function findProduct(w, h) {
  if (!sheetLoaded || sheetData.length === 0) return null;
  // ê°€ë¡œÂ·ì„¸ë¡œ ëª¨ë‘ ì¼ì¹˜í•˜ëŠ” í–‰ ì°¾ê¸° (ìˆ«ì ë¹„êµ)
  return sheetData.find(row => {
    const rw = parseFloat(row.width);
    const rh = parseFloat(row.height);
    return rw === w && rh === h;
  }) || null;
}

function showProduct(w, h) {
  const area = document.getElementById('product-area');
  if (!sheetLoaded) {
    area.innerHTML = '';
    return;
  }
  const product = (w !== null && h !== null) ? findProduct(w, h) : null;

  if (w === null || h === null) {
    area.innerHTML = '';
    return;
  }

  if (product) {
    const price = parseInt(product.price, 10);
    const priceStr = isNaN(price) ? product.price : price.toLocaleString('ko-KR') + 'ì›';
    area.innerHTML = `
      <div class="product-card">
        <div class="product-name">ğŸ“¦ ${product.name}</div>
        <div class="product-price">${priceStr}</div>
      </div>`;
  } else {
    area.innerHTML = `
      <div class="product-card not-found">
        <div class="product-name">âš  ì¼ì¹˜í•˜ëŠ” ì œí’ˆ ì—†ìŒ</div>
        <div class="product-price">ì‹œíŠ¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”</div>
      </div>`;
  }
}

function calculate() {
  const w = parseFloat(document.getElementById('width').value);
  const h = parseFloat(document.getElementById('height').value);
  const d = parseFloat(document.getElementById('depth').value);
  const resultEl = document.getElementById('result');

  const anyFilled = !isNaN(w) || !isNaN(h) || !isNaN(d);
  if (!anyFilled) {
    resultEl.innerHTML = '<div class="placeholder">ì¹˜ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ ë„ë©´ì´ í‘œì‹œë©ë‹ˆë‹¤</div>';
    document.getElementById('product-area').innerHTML = '';
    return;
  }

  const rw = isNaN(w) ? null : w + 30;
  const rh = isNaN(h) ? null : h + 30;
  const rd = isNaN(d) ? null : d + 17;

  // ì œí’ˆ ì •ë³´ í‘œì‹œ (ì›ë³¸ ì¹˜ìˆ˜ë¡œ ë§¤ì¹­)
  showProduct(isNaN(w) ? null : w, isNaN(h) ? null : h);

  resultEl.innerHTML = `<div id="diagram-wrap">${drawDiagram(rw, rh, rd)}</div>`;
}

// â”€â”€ SVG ë„ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmt(v) {
  if (v === null) return 'â€”';
  return Number.isInteger(v) ? v.toString() : v.toFixed(1);
}

function drawDiagram(rw, rh, rd) {
  const svgW = 400, svgH = 300;
  const rawW = rw || 200, rawH = rh || 150, rawD = rd || 30;

  const maxFW = 190, maxFH = 160;
  const aspect = rawW / rawH;
  let fW, fH;
  if (aspect >= 1) { fW = Math.min(maxFW, maxFH * aspect); fH = fW / aspect; }
  else             { fH = Math.min(maxFH, maxFW / aspect); fW = fH * aspect; }
  fW = Math.max(fW, 60); fH = Math.max(fH, 60);

  const depthRatio = rawD / Math.max(rawW, rawH);
  const dOff = Math.max(16, Math.min(48, depthRatio * 130));
  const ox = dOff * 0.85, oy = dOff * 0.48;

  const startX = 55 + ox, startY = 45 + oy;
  const ftl = [startX, startY], ftr = [startX+fW, startY];
  const fbr = [startX+fW, startY+fH], fbl = [startX, startY+fH];
  const btl = [ftl[0]-ox, ftl[1]-oy], btr = [ftr[0]-ox, ftr[1]-oy];
  const bbl = [fbl[0]-ox, fbl[1]-oy];

  const p = pts => pts.map(pt => pt.join(',')).join(' ');
  const frameCol='#c9a96e', sideCol='#9a6e30', topCol='#e8c878';
  const strokeCol='#6e4010', innerCol='#23234a', dimCol='#7dd3fc';
  const ft = 13;

  let svg = `<svg width="${svgW}" height="${svgH}" viewBox="0 0 ${svgW} ${svgH}" xmlns="http://www.w3.org/2000/svg">
  <defs><filter id="sh"><feDropShadow dx="2" dy="5" stdDeviation="5" flood-color="#000" flood-opacity="0.5"/></filter></defs>`;

  svg += `<polygon points="${p([btl,btr,ftr,ftl])}" fill="${topCol}" stroke="${strokeCol}" stroke-width="1.2"/>`;
  svg += `<polygon points="${p([btl,ftl,fbl,bbl])}" fill="${sideCol}" stroke="${strokeCol}" stroke-width="1.2"/>`;
  svg += `<rect x="${ftl[0]}" y="${ftl[1]}" width="${fW}" height="${fH}" fill="${frameCol}" stroke="${strokeCol}" stroke-width="1.5" filter="url(#sh)"/>`;
  svg += `<rect x="${ftl[0]+ft}" y="${ftl[1]+ft}" width="${fW-ft*2}" height="${fH-ft*2}" fill="${innerCol}" stroke="${strokeCol}" stroke-width="0.8"/>`;
  [[ftl,1,1],[ftr,-1,1],[fbr,-1,-1],[fbl,1,-1]].forEach(([pt,sx,sy])=>{
    svg += `<line x1="${pt[0]}" y1="${pt[1]}" x2="${pt[0]+sx*ft}" y2="${pt[1]+sy*ft}" stroke="${strokeCol}" stroke-width="0.8" opacity="0.5"/>`;
  });
  svg += `<line x1="${btl[0]}" y1="${btl[1]}" x2="${btr[0]}" y2="${btr[1]}" stroke="#f5e8b0" stroke-width="1.5" opacity="0.8"/>`;

  const ext = 8, gap = 14;
  if (rw !== null) {
    const y = fbr[1] + gap + 16;
    svg += dimLine(fbl[0], y, fbr[0], y, `${fmt(rw)} mm`, dimCol);
    svg += extLine(fbl[0], fbl[1]+ext, fbl[0], y+5, dimCol);
    svg += extLine(fbr[0], fbr[1]+ext, fbr[0], y+5, dimCol);
  }
  if (rh !== null) {
    const x = fbr[0] + gap + 24;
    svg += dimLine(x, ftr[1], x, fbr[1], `${fmt(rh)} mm`, dimCol);
    svg += extLine(ftr[0]+ext, ftr[1], x+5, ftr[1], dimCol);
    svg += extLine(fbr[0]+ext, fbr[1], x+5, fbr[1], dimCol);
  }
  if (rd !== null) {
    const mx = (ftr[0]+btr[0])/2 - 4, my = (ftr[1]+btr[1])/2 - 10;
    svg += `<line x1="${ftr[0]}" y1="${ftr[1]}" x2="${btr[0]}" y2="${btr[1]}" stroke="${dimCol}" stroke-width="1" stroke-dasharray="3,3"/>`;
    svg += arrowhead(ftr[0], ftr[1], btr[0], btr[1], dimCol);
    svg += arrowhead(btr[0], btr[1], ftr[0], ftr[1], dimCol);
    const angle = Math.atan2(btr[1]-ftr[1], btr[0]-ftr[0]) * 180/Math.PI;
    svg += `<text x="${mx}" y="${my}" fill="${dimCol}" font-family="Space Mono,monospace" font-size="10" font-weight="700"
      text-anchor="middle" transform="rotate(${angle},${mx},${my+5})">${fmt(rd)} mm</text>`;
  }
  svg += `</svg>`;
  return svg;
}

function extLine(x1,y1,x2,y2,col){return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${col}" stroke-width="0.8" opacity="0.6"/>`;}
function arrowhead(x1,y1,x2,y2,col){
  const dx=x2-x1,dy=y2-y1,len=Math.sqrt(dx*dx+dy*dy);
  const ux=dx/len,uy=dy/len,px=-uy,py=ux,s=5;
  return `<polygon points="${x1},${y1} ${x1+ux*s+px*s/2},${y1+uy*s+py*s/2} ${x1+ux*s-px*s/2},${y1+uy*s-py*s/2}" fill="${col}"/>`;
}
function dimLine(x1,y1,x2,y2,label,col){
  const dx=x2-x1,dy=y2-y1,len=Math.sqrt(dx*dx+dy*dy);
  const ux=dx/len,uy=dy/len,px=-uy,py=ux,s=5;
  const ah1=`<polygon points="${x1},${y1} ${x1+ux*s+px*s/2},${y1+uy*s+py*s/2} ${x1+ux*s-px*s/2},${y1+uy*s-py*s/2}" fill="${col}"/>`;
  const ah2=`<polygon points="${x2},${y2} ${x2-ux*s+px*s/2},${y2-uy*s+py*s/2} ${x2-ux*s-px*s/2},${y2-uy*s-py*s/2}" fill="${col}"/>`;
  const mx=(x1+x2)/2,my=(y1+y2)/2,tOff=12;
  const tx=mx+px*tOff,ty=my+py*tOff;
  const angle=Math.atan2(dy,dx)*180/Math.PI;
  const displayAngle=(angle>90||angle<-90)?angle+180:angle;
  return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${col}" stroke-width="1"/>
    ${ah1}${ah2}
    <text x="${tx}" y="${ty}" fill="${col}" font-family="Space Mono,monospace" font-size="11" font-weight="700"
      text-anchor="middle" dominant-baseline="middle" transform="rotate(${displayAngle},${tx},${ty})">${label}</text>`;
}

// ì‹œì‘
loadSheet();
</script>
</body>
</html>
